language: php

sudo: required

matrix:
  fast_finish: true
  include:
    - php: 7.3
      env: PHPCS=1
    - php: 7.2
    - php: 7.1
      env: INSTALL_SODIUM=1
    - php: 7.0
      env: INSTALL_SODIUM=1
    - php: 5.6
      env: INSTALL_SODIUM=1 PREFER_LOWEST=1

before_install:
  - if [[ $INSTALL_SODIUM == 1 ]]; then sudo add-apt-repository ppa:ondrej/php -y; sudo apt-get update -q; sudo apt-get install libsodium-dev build-essential -y; fi

install:
  - if [[ $PREFER_LOWEST != 1 ]]; then composer install --prefer-dist --no-interaction; fi
  - if [[ $PREFER_LOWEST == 1 ]]; then composer update --prefer-dist --no-interaction --prefer-lowest --prefer-stable; fi
  - if [[ $INSTALL_SODIUM == 1 ]]; then if [[ ${TRAVIS_PHP_VERSION:0:3} == "5.6" ]]; then pecl install -f libsodium-1.0.6 && echo "extension=sodium.so" >> ~/.phpenv/versions/$(phpenv version-name)/etc/php.ini; else pecl install -f libsodium; fi; fi

script:
  - sh -c "if [ '$PHPCS' != '1' ]; then vendor/bin/phpunit; fi"
  - sh -c "if [ '$PHPCS' = '1' ]; then ./vendor/bin/phpcs -n -p --extensions=php --standard=PSR2 ./src ./tests; fi"

notifications:
  email: false